# Chapter 15 입출력 I/O

# 1. 자바에서의 입출력

## 1.1 입출력이란?

### **I/O** 

- Input(입력)과 Ouput(출력)의 약자

- **컴퓨터 내부 또는 외부의 장치와 프로그램간의 데이터를 주고받는 것을 말함**

<br/>

<br/>

<br/>

## 1.2 스트림(stream)

자바에서 어느 한쪽에서 다른 쪽으로 데이터를 전달하려면(**입출력을 수행하려면**), 두 대상을 연결하고 데이터를 전송할 수 있는 **스트림**(stream)이 필요하다.

> 14장의 스트림과 같은 용어를 쓰지만 다른 개념

<br/>

### 스트림이란?

- **데이터를 운반(입출력)하는데 사용되는 연결 통로**
- 연속적인 데이터의 흐름을 물에 비유해서 붙여진 이름이다.
- 먼저 보낸 데이터를 먼저 받게 되어있으며 연속적으로 데이터를 주고 받음
- **단반향통신만 가능**하다(하나의 스트림으로 입력과 출력을 동시에 처리 불가)
- 입출력을 동시에 수행하려면, 2개의 스트림이 필요하다
  - input stream(입력 스트림)
  - output stream(출력 스트림)

![Image](https://github.com/user-attachments/assets/26e7e984-2e6f-4c3a-aa5f-8129826e7417)

<br/>

<br/>

<br/>

## 1.3 바이트기반 스트림 - InputStream, OutputStream

바이트기반 스트림은 데이터를 **바이트**(byte)단위로 주고받는다.

<br/>

### 아래는 여러 종류의 입출력 스트림이다.

| 입력스트림           | 출력스트림            | 입출력 대상의 종류          |
| -------------------- | --------------------- | --------------------------- |
| FileInputStream      | FileOutputStream      | 파일                        |
| ByteArrayInputStream | ByteArrayOutputStream | 메모리(byte 배열)           |
| PipedInputStream     | PipedOutputStream     | 프로세스(프로세스간의 통신) |
| AudioInputStream     | AudioOutputStream     | 옹디오장치                  |

만약 어떤 파일의 내용을 읽고자 하는 경우 FileInputStream을 사용하면 된다.

이들은 모두 InputStream, OutputStream의 자손들이며, 각각 읽고 쓰는데 필요한 추상메서드를 자신에 맞게 구현해 놓음

> 자바에선 java.io패키지를 통해서 많은 종류의 입출력관련 클래스들을 제공하고 있으며, 입출력을 처리할 수 있는 표준화된 방법을 제공함으로써 입출력의 대상이 달라져도 동일한 방법으로 입출력이 가능하다.

<br/>

### InputStream과 OutputStream에 정의된 읽기와 쓰기를 수행하는 메서드

| InputStream                          | OutputStream                           |
| ------------------------------------ | -------------------------------------- |
| abstract int read()                  | abstract void write(int b)             |
| int read(byte[] b)                   | void write(byte[] b)                   |
| int read(byte[] b, int off, int len) | void write(byte[] b, int off, int len) |

> read()의 반환타입이 byte가 아니라 int인 이유는 read()의 반환값의 범위가 0~255와 -1이기 때문이다

**InputStream**의 `read()`와 **OutputStream**의 `write(int b)`는 입출력의 대상에 따라 알맞게 구현하라는 의미에서 **추상메서드로 정의되어 있다**. 

추상메서드를 구현안하고 추상메서드가 아닌 다른 메서드 `int read(byte[] b)`, `void write(byte[] b)`를 쓰면 될 것이라고 생각할 수 있지만 사실 **추상메서드**인 `read()`와 `write(int b)`를 이용해서 구현한 것들이여서 **무조건 구현해야함** 

<br/>

<br/>

### InputStream의 실제 소스코드의 일부를 이해하기 쉽게 변형한 버전

```java
public abstract class InputStream{
    ...
        
    // 입력스트림으로 부터 1 byte를 읽어서 반환한다. 읽을 수 없으면 -1을 반환
    abstract int read();
    
    // 입력스트림으로부터 len개의 byte를 읽어서 byte배열 b의 off위치부터 저장한다.
    int read(byte[] b, int off, int len){
        ...
        for(int i=off;i<off+len;i++){
            b[i] = (byte)read();
        }
    }
    ...
        // 입력스트림으로부터 byte배열 b의 크기만큼 데이터를 읽어서 배열 b에 저장한다.
        int read(byte[] b){
        return read(b, 0, b.length);
    }
    ...
}
```

위 코드를 보면 `read(byte[] b)`가 `read(byte[] b, int off, int len)`를 호출하고 `read(byte[] b, int off, int len)`가 추상메서드인 `read()`를 호출하는 것을 알수있다.

**결론적으로 read()는 반드시 구현되어야하는 핵심적인 메서드**

<br/>

<br/>

<br/>

## 1.4 보조 스트림

### 보조스트림

-  스트림의 기능을 향상시키거나 새로운 기능을 추가하기 위해 사용
- 실제 데이터를 주고받는 스트림이 아니기 때문에 **독립적으로 입출력을 수행 못함**

<br/>

**text.txt** 파일을 읽을 때,  입력 성능을 향상시키기 위해 버퍼를 사용하는 **보조스트림인 BufferedInputStream**을 사용하는 코드

```java
// 먼저 기반스트림을 생성한다.
FileInputStream fis = new FileInputStream("test.txt");

// 기반스트림을 이용해서 보조스트림을 생성한다.
BufferdInputStream bis = new BufferedInputStream(fis);
bis.read();	// 보조스트림인 BufferedInputStream으로부터 데이터를 읽는다.
```

- 보조스트림이 입력기능을 수행하는 것처럼 보이지만, **실제 입력기능은** BufferedInputStream과 연결된 **FileInputStream**이 수행
- 보조스트림인 BufferedInputStream은 **버퍼만을 제공**한다.
- 실제로 버퍼를 사용한것과 안한 입출력간의 성능차이는 상당하기에 대부분 버퍼를 이용한 보조스트림 사용한다.

<br/>

<br/>

### 바이트 기반 보조스트림의 종류

| 입력                  | 출력                 | 설명                                                         |
| --------------------- | -------------------- | ------------------------------------------------------------ |
| FilterInputStream     | FilterOutputStream   | 필터를 이용한 입출력 처리                                    |
| BufferedInputStream   | BufferedOutputStream | 버퍼를 이용한 입출력 성능향상                                |
| DataInputStream       | DataOutputStream     | int, float와 같은 기본형 단위로 데이터를 처리하는 기능       |
| SequenceInputStream   | 없음                 | 두 개의  스트림을 하나로 연결                                |
| LineNumberInputStream | 없음                 | 읽어 온 데이터의 라인 번호를 카운트<br />(JDK1.1부터 LineNumberReader로 대체) |
| ObjectInputStream     | ObjectOutputStream   | 데이터를 객체단위로 읽고 쓰는데 사용.<br />주로 파일을 이용하며 객체 직렬화와 관련있음 |
| 없음                  | PrintStream          | 버퍼를 이용하며, 추가적인 print관련 기능<br />(print, printf, println메서드) |
| PushbackInputStream   | 없음                 | 버퍼를 이용해서 읽어온 데이터를 다시 되돌리는 기능<br />(unread, push back to buffer) |

모든 보조스트림은 InputStream과 OutputStream의 자손들이므로 입출력방법이 같다.

![Image](https://github.com/user-attachments/assets/d4a3401a-1b72-4894-8432-0966512d1243)

<br/>

<br/>

<br/>

## 1.5 문자기반 스트림 - Reader, Writer

입출력 단위가 **문자**(char, 2byte)인 스트림, 문자기반 스트림의 최고 조상이다.

<br/>

```
InputStream  -------> Reader
OutputStream -------> Writer
```

### 바이트기반 스트림과 문자기반 스트림 비교

| 바이트기반 스트림                                            | 문자기반 스트림                      |
| ------------------------------------------------------------ | ------------------------------------ |
| FileInputStream<br />FileOuputStream                         | FileReader<br />FileWriter           |
| ByteArrayInputStream<br />ByteArrayOuputStream               | CharArrayReader<br />CharArrayWriter |
| PipedInputStream<br />PipedOutputStream                      | PipedReader<br />PipedWriter         |
| StringBufferInputStream(deprecated)<br />StringBufferOutputStream(deprecated) | StringReader<br />StringWriter       |

<br/>

<br/>

### 읽고 쓰는 메서드 비교

| InputStream                                                  | Reader                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| abstract int read()<br/>int read(byte[] b)<br/>int read(byte[] b, int off, int len) | int read()<br/>int read(char[] cbuf)<br/>abstract int read(char[] cbuf, int off, int len) |

| OutputStream                                                 | Writer                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| abstract void write(int b)<br/>void write(byte[] b)<br/>void write(byte[] b, int off, int len) | void write(int c)<br/>void write(char[] cbuf)<br/>abstract void write(char[] cbuf, int off, int len)<br/>void write(String str)<br/>void write(String str, int off, int len) |

<br/>

<br/>

### 보조스트림 비교

| 바이트기반 보조스트림                         | 문자기반 보조스트림                |
| --------------------------------------------- | ---------------------------------- |
| BufferedInputStream<br />BufferedOuputtStream | BufferedReader<br />BufferedWriter |
| FilterInputStream<br />FilterOutputStream     | FilterReader<br />FilterWriter     |
| LineNumberInputStream(deprecated)             | LineNumberReader                   |
| PushbackInputStream                           | PushbackReader                     |

<br/>

<br/>

<br/>

<br/>

